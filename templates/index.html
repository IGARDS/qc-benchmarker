<html lang="en">
<head>

    <meta charset="UTF-8">

    <link rel="stylesheet" 
     href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/min/dropzone.min.css"/>

    <link rel="stylesheet" 
     href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/min/basic.min.css"/>

    <script type="application/javascript" 
     src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/min/dropzone.min.js">
    </script>
    
    <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </head>

    <title>QC Benchmarker</title>
    
    <style>
        #parent {
            text-align:left;
            max-width:800px;
        }
        .btn-group button {
          background-color: #4CAF50; /* Green background */
          border: 1px solid green; /* Green border */
          color: white; /* White text */
          padding: 10px 24px; /* Some padding */
          cursor: pointer; /* Pointer/hand icon */
          float: left; /* Float the buttons side by side */
        }

        .btn-group2 button {
          background-color: #4CAF50; /* Green background */
          border: 1px solid green; /* Green border */
          color: white; /* White text */
          padding: 10px 24px; /* Some padding */
          cursor: pointer; /* Pointer/hand icon */
          float: center; /* Float the buttons side by side */
        }

        /* Clear floats (clearfix hack) */
        .btn-group:after {
          content: "";
          clear: both;
          display: table;
        }

        .btn-group button:not(:last-child) {
          border-right: none; /* Prevent double borders */
        }

        /* Add a background color on hover */
        .btn-group button:hover {
          background-color: #3e8e41;
        }
        
        iframe[seamless]{
            background-color: transparent;
            border: 0px none transparent;
            padding: 0px;
            overflow: hidden;
            float: left;
            margin:0 auto;            
        }
    </style>
</head>
<body>

<center>
<div id="parent">
<center>

<div class="btn-group2">
  <button id='documentation' onclick="window.location.href = '/documentation'">Documentation</button>
  <button id='about' onclick="window.location.href = '/about'">About</button>
  <button id='disclaimer' onclick="window.location.href = '/disclaimer'">Disclaimer</button>
  <button id='privacy_concerns' onclick="window.location.href = '/privacy'">Privacy Concerns</button>
</div>

</center>
    
<p>
Save this url for future reference: <a id="save_url" href="/index/{{ work_dir }}">TBA</a><br><br>
    
<script type="application/javascript">
    if (!document.URL.includes("{{ work_dir }}")) {
        document.getElementById('save_url').innerHTML = document.URL +"{{ work_dir }}" 
        window.location.replace(document.getElementById('save_url').innerHTML);
    } else {
        document.getElementById('save_url').innerHTML = document.URL
    }
</script>

<form method="POST" action='/upload' class="dropzone dz-clickable" 
      id="dropper" enctype="multipart/form-data">
    <input type="hidden" id="work_dir" name="work_dir" value="{{ work_dir }}">
</form>

<script type="application/javascript">
    Dropzone.options.dropper = {
        dictDefaultMessage: 'Drop raw file here<p>By uploading a file you acknowledge reading the disclaimer',
        paramName: 'file',
        chunking: true,
        forceChunking: true,
        url: '/upload',
        maxFilesize: 5025, // megabytes
        chunkSize: 1000000 // bytes
    }
</script>
    
<hr>
        
{% for raw_file in raw_files %}
    <h3>{{ raw_file }}</h3>
    <div class="btn-group">
      <button id='preprocess_{{ raw_file }}'>Preprocess</button>
      <button id='sample_{{ raw_file }}'>Sample</button>
      <button id='lc_{{ raw_file }}'>LC</button>
      <button id='source_{{ raw_file }}'>Source</button>
      <button id='ms1_{{ raw_file }}'>MS1</button>
      <button id='ms2_{{ raw_file }}'>MS2</button>
      <button id='full_report_{{ raw_file }}'>Full Report</button>
    </div>
{% endfor %}
   
<script>
makePostCall = function (url, data) { // here the data and url are not hardcoded anymore
   var json_data = JSON.stringify(data);

    return $.ajax({
        type: "POST",
        url: url,
        data: json_data,
        dataType: "json",
        contentType: "application/json;charset=utf-8"
    });
}
</script>
    
{% for raw_file in raw_files %}

{% if ( ( raw_file in result_files ) and ( 'preprocess' in result_files[raw_file]) ) %}
<script>
$( "#preprocess_{{ raw_file }}" ).click(function() {
            $("#iframe_results").attr('src', "{{ result_files[raw_file]['preprocess'] }}");
        })
$("#preprocess_{{ raw_file }}").css('background-color','#3e8e41');
</script>
{% else %}
<script>
$( "#preprocess_{{ raw_file }}" ).click(function() {
    var checkedValue = "{{ raw_file }}"; //$('#raw_files_array:checked').val();

    makePostCall("/run/preprocess/"+checkedValue, {'work_dir' : '{{ work_dir }}'})
    .then(function successCallback(response) {
       // this callback will be called asynchronously
       // when the response is available

        console.log(response)

    }, function errorCallback(response) {
       // called asynchronously if an error occurs
       // or server returns response with an error status.
        alert("Something went wrong!")
    })
});
</script>
{% endif %}
    
{% if ( ( raw_file in result_files ) and ( 'sample' in result_files[raw_file]) ) %}
<script>
$( "#sample_{{ raw_file }}" ).click(function() {
            $("#iframe_results").attr('src', "{{ result_files[raw_file]['sample'] }}");
        })
$("#sample_{{ raw_file }}").css('background-color','#3e8e41');
</script>
{% elif ( ( raw_file in result_files ) and ( 'preprocess' in result_files[raw_file]) ) %}
<script>
$( "#sample_{{ raw_file }}" ).click(function() {
    var checkedValue = "{{ raw_file }}"; //$('#raw_files_array:checked').val();

    makePostCall("/run/sample/"+checkedValue, {'work_dir' : '{{ work_dir }}', 'id': '{{ id_result_files[raw_file]["preprocess"] }}'})
    .then(function successCallback(response) {
       // this callback will be called asynchronously
       // when the response is available

        console.log(response)

    }, function errorCallback(response) {
       // called asynchronously if an error occurs
       // or server returns response with an error status.
        alert("Something went wrong!")
    })
});
</script>
{% endif %}

{% if ( ( raw_file in result_files ) and ( 'lc' in result_files[raw_file]) ) %}
<script>
$( "#lc_{{ raw_file }}" ).click(function() {
            $("#iframe_results").attr('src', "{{ result_files[raw_file]['lc'] }}");
        })
$("#lc_{{ raw_file }}").css('background-color','#3e8e41');
</script>
{% elif ( ( raw_file in result_files ) and ( 'preprocess' in result_files[raw_file]) ) %}
<script>
$( "#lc_{{ raw_file }}" ).click(function() {
    var checkedValue = "{{ raw_file }}"; //$('#raw_files_array:checked').val();

    makePostCall("/run/lc/"+checkedValue, {'work_dir' : '{{ work_dir }}', 'id': '{{ id_result_files[raw_file]["preprocess"] }}'})
    .then(function successCallback(response) {
       // this callback will be called asynchronously
       // when the response is available

        console.log(response)

    }, function errorCallback(response) {
       // called asynchronously if an error occurs
       // or server returns response with an error status.
        alert("Something went wrong!")
    })
});
</script>
{% endif %}

{% if ( ( raw_file in result_files ) and ( 'source' in result_files[raw_file]) ) %}
<script>
$( "#source_{{ raw_file }}" ).click(function() {
            $("#iframe_results").attr('src', "{{ result_files[raw_file]['source'] }}");
        })
$("#source_{{ raw_file }}").css('background-color','#3e8e41');
</script>
{% elif ( ( raw_file in result_files ) and ( 'preprocess' in result_files[raw_file]) ) %}
<script>
$( "#source_{{ raw_file }}" ).click(function() {
    var checkedValue = "{{ raw_file }}"; //$('#raw_files_array:checked').val();

    makePostCall("/run/source/"+checkedValue, {'work_dir' : '{{ work_dir }}', 'id': '{{ id_result_files[raw_file]["preprocess"] }}'})
    .then(function successCallback(response) {
       // this callback will be called asynchronously
       // when the response is available

        console.log(response)

    }, function errorCallback(response) {
       // called asynchronously if an error occurs
       // or server returns response with an error status.
        alert("Something went wrong!")
    })
});
</script>
{% endif %}

{% if ( ( raw_file in result_files ) and ( 'ms1' in result_files[raw_file]) ) %}
<script>
$( "#ms1_{{ raw_file }}" ).click(function() {
            $("#iframe_results").attr('src', "{{ result_files[raw_file]['ms1'] }}");
        })
$("#ms1_{{ raw_file }}").css('background-color','#3e8e41');
</script>
{% elif ( ( raw_file in result_files ) and ( 'preprocess' in result_files[raw_file]) ) %}
<script>
$( "#ms1_{{ raw_file }}" ).click(function() {
    var checkedValue = "{{ raw_file }}"; //$('#raw_files_array:checked').val();

    makePostCall("/run/ms1/"+checkedValue, {'work_dir' : '{{ work_dir }}', 'id': '{{ id_result_files[raw_file]["preprocess"] }}'})
    .then(function successCallback(response) {
       // this callback will be called asynchronously
       // when the response is available

        console.log(response)

    }, function errorCallback(response) {
       // called asynchronously if an error occurs
       // or server returns response with an error status.
        alert("Something went wrong!")
    })
});
</script>
{% endif %}

{% if ( ( raw_file in result_files ) and ( 'ms2' in result_files[raw_file]) ) %}
<script>
$( "#ms2_{{ raw_file }}" ).click(function() {
            $("#iframe_results").attr('src', "{{ result_files[raw_file]['ms2'] }}");
        })
$("#ms2_{{ raw_file }}").css('background-color','#3e8e41');
</script>
{% elif ( ( raw_file in result_files ) and ( 'preprocess' in result_files[raw_file]) ) %}
<script>
$( "#ms2_{{ raw_file }}" ).click(function() {
    var checkedValue = "{{ raw_file }}"; //$('#raw_files_array:checked').val();

    makePostCall("/run/ms2/"+checkedValue, {'work_dir' : '{{ work_dir }}', 'id': '{{ id_result_files[raw_file]["preprocess"] }}'})
    .then(function successCallback(response) {
       // this callback will be called asynchronously
       // when the response is available

        console.log(response)

    }, function errorCallback(response) {
       // called asynchronously if an error occurs
       // or server returns response with an error status.
        alert("Something went wrong!")
    })
});
</script>
{% endif %}

{% if ( ( raw_file in result_files ) and ( 'full_report' in result_files[raw_file]) ) %}
<script>
$( "#full_report_{{ raw_file }}" ).click(function() {
            $("#iframe_results").attr('src', "{{ result_files[raw_file]['full_report'] }}");
        })
$("#full_report_{{ raw_file }}").css('background-color','#3e8e41');
</script>
{% elif ( ( raw_file in result_files ) and ( 'preprocess' in result_files[raw_file]) ) %}
<script>
$( "#full_report_{{ raw_file }}" ).click(function() {
    var checkedValue = "{{ raw_file }}"; //$('#raw_files_array:checked').val();

    makePostCall("/run/full_report/"+checkedValue, {'work_dir' : '{{ work_dir }}', 'id': '{{ id_result_files[raw_file]["preprocess"] }}'})
    .then(function successCallback(response) {
       // this callback will be called asynchronously
       // when the response is available

        console.log(response)

    }, function errorCallback(response) {
       // called asynchronously if an error occurs
       // or server returns response with an error status.
        alert("Something went wrong!")
    })
});
</script>
{% endif %}
    
{% endfor %}

<div class="btn-group">
<form>
<button id='click_refresh_raw_files'>Click to Refresh</button>
</form>
</div>
    
<script>
$( "#click_refresh_raw_files" ).click(function() {
  if (document.URL.includes("{{ work_dir }}")) {
      $( "#raw_files_list" ).load(document.URL +  ' #raw_files_list');
  } else {
      $( "#raw_files_list" ).load(document.URL+"{{ work_dir }}" +  ' #raw_files_list');
  }
});
</script>
    
<hr>
    
<iframe id="iframe_results" src='about:blank' width="100%" height="100%" seamless></iframe>

</div>
</center>
</body>
</html>
<html lang="en">
<head>

    <meta charset="UTF-8">

    <link rel="stylesheet" 
     href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/min/dropzone.min.css"/>

    <link rel="stylesheet" 
     href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/min/basic.min.css"/>

    <script type="application/javascript" 
     src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.4.0/min/dropzone.min.js">
    </script>
    
    <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </head>

    <title>QC Benchmarker</title>
    
    <style>
        .btn-group button {
          background-color: #4CAF50; /* Green background */
          border: 1px solid green; /* Green border */
          color: white; /* White text */
          padding: 10px 24px; /* Some padding */
          cursor: pointer; /* Pointer/hand icon */
          float: left; /* Float the buttons side by side */
        }

        /* Clear floats (clearfix hack) */
        .btn-group:after {
          content: "";
          clear: both;
          display: table;
        }

        .btn-group button:not(:last-child) {
          border-right: none; /* Prevent double borders */
        }

        /* Add a background color on hover */
        .btn-group button:hover {
          background-color: #3e8e41;
        }
        
        iframe[seamless]{
            background-color: transparent;
            border: 0px none transparent;
            padding: 0px;
            overflow: hidden;
        }
    </style>
</head>
<body>
    
Save this url for future reference: <a id="save_url" href="/index/{{ work_dir }}">TBA</a><br><br>
    
<script type="application/javascript">
    if (!document.URL.includes("{{ work_dir }}")) {
        document.getElementById('save_url').innerHTML = document.URL +"{{ work_dir }}" 
    } else {
        document.getElementById('save_url').innerHTML = document.URL
    }
</script>

<form method="POST" action='/upload' class="dropzone dz-clickable" 
      id="dropper" enctype="multipart/form-data">
    <input type="hidden" id="work_dir" name="work_dir" value="{{ work_dir }}">
</form>

<script type="application/javascript">
    Dropzone.options.dropper = {
        paramName: 'file',
        chunking: true,
        forceChunking: true,
        url: '/upload',
        maxFilesize: 5025, // megabytes
        chunkSize: 10000000 // bytes
    }
</script>
    
<hr>
<h2>Raw Files</h2><p>
<div id="raw_files_list">    
{% for raw_file in raw_files %}
    <input type="checkbox" value="{{ raw_file }}" id="raw_files_array" name="raw_files_array[]" />{{ raw_file }}<p>
{% endfor %}
</div>
<div class="btn-group">
<form>
<button id='click_refresh_raw_files'>Click to Refresh</button>
</form>
</div>
    
<script type="application/javascript">
    // the selector will match all input controls of type :checkbox
    // and attach a click event handler 
    $("input:checkbox").on('click', function() {
      // in the handler, 'this' refers to the box clicked on
      var $box = $(this);
      if ($box.is(":checked")) {
        // the name of the box is retrieved using the .attr() method
        // as it is assumed and expected to be immutable
        var group = "input:checkbox[name='" + $box.attr("name") + "']";
        // the checked state of the group/box on the other hand will change
        // and the current value is retrieved using .prop() method
        $(group).prop("checked", false);
        $box.prop("checked", true);
      } else {
        $box.prop("checked", false);
      }
    });
</script>
    
<hr>
    
<script>
$( "#click_refresh_raw_files" ).click(function() {
  $( "#raw_files_list" ).load(document.URL +  ' #raw_files_list');
});
</script>
    
<h2>Reports</h2>
    
<div class="btn-group">
  <button id='preprocess'>Preprocess</button>
  <button id='sample'>Sample</button>
  <button>LC</button>
  <button>Source</button>
  <button>MS1</button>
  <button>MS2</button>
  <button>Full Report</button>
</div>
   
<div id="result_files_list">
    <hr>
    <h2>Results</h2>
    <ul>
    {% for method in result_files.keys() %}
        <li><div id="{{ method }}_results">{{ method.upper() }}</div></li>
    {% endfor %}
    </ul>
</div>
<div class="btn-group">
<form>
<button id='click_refresh_result_files'>Click to Refresh</button>
</form>
</div>
    <hr>
    
<iframe id="iframe_results" src='about:blank' width="100%" height="100%" seamless></iframe>
    
<script>
$( "#click_refresh_result_files" ).click(function() {
  $( "#result_files_list" ).load(document.URL +  ' #result_files_list');
});
</script>
    
{% for method in result_files.keys() %}
    <script type="application/javascript">
        $( "#{{ method }}_results" ).click(function() {
            $("#iframe_results").attr('src', "{{ result_files[method] }}");
        })
    </script>
{% endfor %}
    
<script>
makePostCall = function (url, data) { // here the data and url are not hardcoded anymore
   var json_data = JSON.stringify(data);

    return $.ajax({
        type: "POST",
        url: url,
        data: json_data,
        dataType: "json",
        contentType: "application/json;charset=utf-8"
    });
}
    
$( "#preprocess" ).click(function() {
    var checkedValue = $('#raw_files_array:checked').val();

    makePostCall("/run/preprocess/"+checkedValue, {'work_dir' : '{{ work_dir }}'})
    .then(function successCallback(response) {
       // this callback will be called asynchronously
       // when the response is available

        console.log(response)

    }, function errorCallback(response) {
       // called asynchronously if an error occurs
       // or server returns response with an error status.
        alert("Something went wrong!")
    })
});
    
</script>
    
</body>
</html>